<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, intial-scale=1, shrink-to-fit=no">
    <title>Helfy - Registration</title>

    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/main.css" />
    <script src="js/server.js"></script>
    <script src="js/session.js"></script> 
    <script src="js/navigation.js"></script>
    <script type="text/javascript" src="bootstrap/bootstrap-plugins_v1.1/v1.1/bootstrap-plugins.min.js"></script>

    <link rel="apple-touch-icon" sizes="180x180" href="img/Icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/Icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/Icons/favicon-16x16.png">
    <link rel="manifest" href="img/Icons/site.webmanifest">
    <link rel="mask-icon" href="img/Icons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

</head>
<body onload="alreadyRegistrated(); menu(); footer();">

    <div id="mySidenav" class="sidenav">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        <div id="me"><a href="home.html">Home</a></div>
        <a href="einstellungen.html">Einstellungen</a>
        <a href="notification.html" class="badge1" data-badge="" id="notifiBadge">Nachrichten</a>
        <a href="chat.html">Chats</a>
        <a href="gruppen.html">Gruppen</a>
        <a href="rides.html">Eigene Fahrten</a>
        <br />
      </div>

      <div>

            <div style="float: left; height:50px; width: 50px;" id="menu">
            <img src="img/Menu.png" height="50px" style="margin-left: 5px; margin-top: 10%;" onclick="openNav()"></img>
            </div>
    </div>

  <div class="container-float">
          <h1 class="header">Helfy - Registration</h1>
    <div id="maincontent">
    <p id="simpleoutput"></p>
    <div id="formular">
      <form class="needs-validation" id="registform" novalidate>
        <div class="form-row">
          <div class="col-md-6 mb-3">
            <label for="validationVname">Vorname *</label>
            <input type="text" class="form-control" id="validationVname" placeholder="Vorname" onkeyup="autoUsername()"  name="vname" required>
          </div>
          <div class="col-md-6 mb-3">
            <label for="validationNname">Nachname *</label>
            <input type="text" class="form-control" id="validationNname" placeholder="Nachname" onkeyup="autoUsername()"  name="nname" required>
          </div>
        </div>
        <div class="form-row">
            <div class="col-md-6 mb-3">
                <label for="validationEmail">E-Mail Adresse *</label>
                <input type="email" class="form-control" id="validationEmail" placeholder="email@example.com" name="email" required>
                <div class="invalid-feedback" id="invalid-email">
                  Bitte geben Sie eine gültige E-mail an!
                </div>
            </div>
        </div>
        <div class="form-row">
                <div class="col-md-6 mb-3">
                  <label for="validationUsername">Benutzername *</label>
                  <div class="input-group">
                    <div class="input-group-prepend">
                      <span class="input-group-text" id="inputGroupPrepend">@</span>
                    </div>
                    <input type="text" class="form-control" id="validationUsername" placeholder="Benutzername" onkeyup="usernameCorrection()" aria-describedby="inputGroupPrepend"  name="username" required>
                    <div class="invalid-feedback">
                      Bitte wählen Sie einen Benutzernamen.
                    </div>
                    <p id="usernameret" style="padding: 10px; font-size: 13px;"></p>
                  </div>
                </div>
              </div>
        <div class="form-row">
          <div class="col-md-6 mb-3">
            <label for="validationPassword">Passwort *</label>
            <input type="password" class="form-control" id="validationPassword" placeholder="Passwort" onkeyup="pwdSame()"  name="pwd" required>
            <div class="invalid-feedback">
              Sie müssen ein Passwort eingeben.
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <label for="validationPasswordWdh">Passwort wiederholen *</label>
            <input type="password" class="form-control" id="validationPasswordWdh" placeholder="Passwort wiederholen" onkeyup="pwdSame()"  name="pwdWdh" required>
            <div class="invalid-feedback">
              Sie müssen Ihr Passwort wiederholen.
            </div>
          </div>
        <p id="passwordsame" style="margin-bottom: 14px; margin-left: 12px; font-size: 13px;"></p>
        </div>
        <div class="form-row">
          <div class="col-md-6 mb-3">
            <label for="validationOrt">Ort</label>
            <input type="text" class="form-control" id="validationOrt" placeholder="Ort" name="ort">
          </div>
          <div class="col-md-3 mb-3">
            <label for="validationPlz">Postleitzahl</label>
            <input type="text" class="form-control" id="validationPlz" placeholder="PLZ" name="plz">
          </div>
        </div>
        <div class="form-group">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="validationCheckbox" name="check" required>
            <label class="form-check-label" for="validationCheckbox">
              Ich stimme den Nutzerbedingungen zu. *
            </label>
            <div class="invalid-feedback">
              Sie müssen zustimmen um sich registrieren zu können!
            </div>
          </div>
        </div>
        <div class="form-row" style="font-size: 14px; padding: 12px;">
          Die mit * markierten Felder müssen ausgefüllt werden.
        </div>
        <div style="margin-top: 10px; text-align: center;">
          <input class="btn btn-primary" type="submit" method="get" value="Registrieren">
          <input type="hidden" name="state" value="registme">
        </div>
      </form>
      
      <script src="js/registrateUser.js"></script>
      <script>

      function findGetParameter(parameterName) {
          var result = null,
              tmp = [];
          location.search
              .substr(1)
              .split("&")
              .forEach(function (item) {
                tmp = item.split("=");
                if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
              });
          return result;
      }

      if(findGetParameter("state") == "registme"){
        window.location.href = "actinfo.html?state=registme&username=" + findGetParameter("username") + "&pwd=" + findGetParameter("pwd") + "&pwdWdh=" + findGetParameter("pwdWdh") + "&email=" + findGetParameter("email") + "&vname=" + findGetParameter("vname") + "&nname=" + findGetParameter("nname") + "&ort=" + findGetParameter("ort") + "&plz=" + findGetParameter("plz");
      }

        // Example starter JavaScript for disabling form submissions if there are invalid fields
        (function() {
          'use strict';
          window.addEventListener('load', function() {
            var forms = document.getElementsByClassName('needs-validation');
            var validation = Array.prototype.filter.call(forms, function(form) {
              form.addEventListener('submit', function(event) {
                if (form.checkValidity() === false) {
                  event.preventDefault();
                  event.stopPropagation();
                }
                form.classList.add('was-validated');
              }, false);
            });
          }, false);
        })();

        function pwdSame(){
          var pwd1 = document.getElementById("validationPassword").value;
          var pwd2 = document.getElementById("validationPasswordWdh").value;
          if(pwd1 != pwd2 && pwd2 != "" && pwd1 != ""){
            document.getElementById("passwordsame").innerHTML = "Die Passwörter stimmen nicht überein.";
            document.getElementById("passwordsame").style.color = "red";
          } else if(pwd1 == pwd2 && pwd1 != "") {
            document.getElementById("passwordsame").innerHTML = "Die Passwörter stimmen überein.";
            document.getElementById("passwordsame").style.color = "green";
          } else {
            document.getElementById("passwordsame").innerHTML = "";
          }
        }

        function usernameCorrection(){
          var username = document.getElementById("validationUsername");
          if(username.value.includes("?") || username.value.includes("&") || username.value.includes("=") || username.value.includes(" ") || username.value.includes("!") || username.value.includes("\"") || username.value.includes("'") || username.value.includes("#") || username.value.includes("*")){
            username.value = username.value.replace("?", "").replace("&", "").replace("=", "").replace(" ", "").replace("!", "").replace("\"", "").replace("'", "").replace("*", "").replace("#", "");
            document.getElementById("usernameret").innerHTML = "Sie können kein Leerzeichen sowie !?&=\"'#* benutzen.";
            document.getElementById("usernameret").style.color = "red";
          }
        }

        function autoUsername(){
          var vname = document.getElementById("validationVname").value.toLowerCase();
          var nname = document.getElementById("validationNname").value.toLowerCase();
          var username = document.getElementById("validationUsername");
          if(vname + "." + nname == "."){
              username.value = "";    
          } else if(vname != "" && nname != "") {
              username.value = vname.replace(" ", ".") + "." + nname.replace(" ", ".");
          }
        } 
      </script>
      <br />
    </div>
    </div>
    <div id="alreadyregistrated" style="display: none">
      <br /><br />
      <p style="text-align: center; color: red;">Bitte melden Sie sich ab bevor sie einen neuen Account anlegen.</p>
      <p style="text-align: center;"><a href="javascript:history.back()" style="color: darkblue;">Zurück</a></p>
    </div>
  </div>

  <br />

  <div id="footer">
    <hr style="margin: 10px; border-radius: 20px; color: darkgray; border-color: darkgrey;">
    <p style="margin-top: 2%;">
    <a href="login.html">Login</a> | <a href="#" onclick="logout()">Logout</a> | <a href="about.html">Über uns</a> | <a href="impressum.html">Impressum</a>
    </p>
    <div style="color: grey; font-size: 10px; margin-bottom: 1%;">Copyright 2018 - <div id="thisyear" style="display: inline-block;"></div> Achim Stumpp, Jakob Stolze</div>
</div>
  
</body>
</html>