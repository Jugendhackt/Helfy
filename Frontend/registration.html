<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, intial-scale=1, shrink-to-fit=no">
    <title>Helfy - Registration</title>

    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/main.css" />
</head>
<body>
  <div class="container-float">
          <h1 class="header">Helfy</h1>
    <p id="simpleoutput"></p>
    <div id="formular">
      <form class="needs-validation" id="registform" novalidate>
        <div class="form-row">
          <div class="col-md-6 mb-3">
            <label for="validationVname">Vorname *</label>
            <input type="text" class="form-control" id="validationVname" placeholder="Vorname" onkeyup="autoUsername()"  name="vname" required>
          </div>
          <div class="col-md-6 mb-3">
            <label for="validationNname">Nachname *</label>
            <input type="text" class="form-control" id="validationNname" placeholder="Nachname" onkeyup="autoUsername()"  name="nname" required>
          </div>
        </div>
        <div class="form-row">
            <div class="col-md-6 mb-3">
                <label for="validationEmail">E-Mail Adresse *</label>
                <input type="text" class="form-control" id="validationEmail" placeholder="email@example.com"  name="email" required>
                <div class="invalid-feedback">
                        Sie müssen später ihre E-Mail Adresse bestätigen.
                </div>
            </div>
        </div>
        <div class="form-row">
                <div class="col-md-6 mb-3">
                  <label for="validationUsername">Benutzername *</label>
                  <div class="input-group">
                    <div class="input-group-prepend">
                      <span class="input-group-text" id="inputGroupPrepend">@</span>
                    </div>
                    <input type="text" class="form-control" id="validationUsername" placeholder="Benutzername" onkeyup="usernameCorrection()" aria-describedby="inputGroupPrepend"  name="username" required>
                    <div class="invalid-feedback">
                      Bitte wählen Sie einen Benutzernamen.
                    </div>
                    <p id="usernameret" style="padding: 10px; font-size: 13px;"></p>
                  </div>
                </div>
              </div>
        <div class="form-row">
          <div class="col-md-6 mb-3">
            <label for="validationPassword">Passwort *</label>
            <input type="password" class="form-control" id="validationPassword" placeholder="Passwort" onkeyup="pwdSame()"  name="pwd" required>
            <div class="invalid-feedback">
              Sie müssen ein Passwort eingeben.
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <label for="validationPasswordWdh">Passwort wiederholen *</label>
            <input type="password" class="form-control" id="validationPasswordWdh" placeholder="Passwort wiederholen" onkeyup="pwdSame()"  name="pwdWdh" required>
            <div class="invalid-feedback">
              Sie müssen Ihr Passwort wiederholen.
            </div>
          </div>
        <p id="passwordsame" style="margin-bottom: 14px; margin-left: 12px; font-size: 13px;"></p>
        </div>
        <div class="form-row">
          <div class="col-md-6 mb-3">
            <label for="validationOrt">Ort</label>
            <input type="text" class="form-control" id="validationOrt" placeholder="Ort" name="ort">
          </div>
          <div class="col-md-3 mb-3">
            <label for="validationPlz">Postleitzahl</label>
            <input type="text" class="form-control" id="validationPlz" placeholder="PLZ" name="plz">
          </div>
        </div>
        <div class="form-group">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="validationCheckbox" name="check" required>
            <label class="form-check-label" for="validationCheckbox">
              Ich stimme den Nutzerbedingungen zu. *
            </label>
            <div class="invalid-feedback">
              Sie müssen zustimmen um sich registrieren zu können!
            </div>
          </div>
        </div>
        <div class="form-row" style="font-size: 14px; padding: 12px;">
          Die mit * markierten Felder müssen ausgefüllt werden.
        </div>
        <div style="margin-top: 10px; text-align: center;">
          <input class="btn btn-primary" type="submit" method="get" value="Registrieren">
          <input type="hidden" name="state" value="registme">
        </div>
      </form>
      
      <script src="js/registrateUser.js"></script>
      <script>

      function findGetParameter(parameterName) {
          var result = null,
              tmp = [];
          location.search
              .substr(1)
              .split("&")
              .forEach(function (item) {
                tmp = item.split("=");
                if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
              });
          return result;
      }

      if(findGetParameter("state") == "registme"){
        window.location.href = "actinfo.html?state=registme&username=" + findGetParameter("username") + "&pwd=" + findGetParameter("pwd") + "&pwdWdh=" + findGetParameter("pwdWdh") + "&email=" + findGetParameter("email") + "&vname=" + findGetParameter("vname") + "&nname=" + findGetParameter("nname") + "&ort=" + findGetParameter("ort") + "&plz=" + findGetParameter("plz");
      }

        // Example starter JavaScript for disabling form submissions if there are invalid fields
        (function() {
          'use strict';
          window.addEventListener('load', function() {
            var forms = document.getElementsByClassName('needs-validation');
            var validation = Array.prototype.filter.call(forms, function(form) {
              form.addEventListener('submit', function(event) {
                if (form.checkValidity() === false) {
                  event.preventDefault();
                  event.stopPropagation();
                }
                form.classList.add('was-validated');
              }, false);
            });
          }, false);
        })();

        function pwdSame(){
          var pwd1 = document.getElementById("validationPassword").value;
          var pwd2 = document.getElementById("validationPasswordWdh").value;
          if(pwd1 != pwd2 && pwd2 != "" && pwd1 != ""){
            document.getElementById("passwordsame").innerHTML = "Die Passwörter stimmen nicht überein.";
            document.getElementById("passwordsame").style.color = "red";
          } else if(pwd1 == pwd2 && pwd1 != "") {
            document.getElementById("passwordsame").innerHTML = "Die Passwörter stimmen überein.";
            document.getElementById("passwordsame").style.color = "green";
          } else {
            document.getElementById("passwordsame").innerHTML = "";
          }
        }

        function usernameCorrection(){
          var username = document.getElementById("validationUsername");
          if(username.value.includes("?") || username.value.includes("&") || username.value.includes("=") || username.value.includes(" ") || username.value.includes("!") || username.value.includes("\"") || username.value.includes("'") || username.value.includes("#") || username.value.includes("*")){
            username.value = username.value.replace("?", "").replace("&", "").replace("=", "").replace(" ", "").replace("!", "").replace("\"", "").replace("'", "").replace("*", "").replace("#", "");
            document.getElementById("usernameret").innerHTML = "Sie können kein Leerzeichen sowie !?&=\"'#* benutzen.";
            document.getElementById("usernameret").style.color = "red";
          }
        }

        function autoUsername(){
          var vname = document.getElementById("validationVname").value.toLowerCase();
          var nname = document.getElementById("validationNname").value.toLowerCase();
          var username = document.getElementById("validationUsername");
          if(vname + "." + nname == "."){
              username.value = "";    
          } else if(vname != "" && nname != "") {
              username.value = vname.replace(" ", ".") + "." + nname.replace(" ", ".");
          }
        }
        
      </script>
      <br />
    </div>
  </div>

  <br />

  <div id="footer">
      <hr style="margin: 10px; border-radius: 20px;">
      <p style="margin-top: 2%;">by Tobias, Achim, Jakob | <a href="login.html">Log In</a> | <a href="#">Log Out</a></p>
  </div>
  
</body>
</html>